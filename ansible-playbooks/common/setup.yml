- name: chsh zsh (shell)
  become: yes
  user:
    name: "{{ the_user }}"
    shell: /bin/zsh
  tags:
    - zsh
    - cli

- name: oh-my-zsh install (git)
  shell: sh -c "$(curl -fsSL https://raw.githubusercontent.com/ohmyzsh/ohmyzsh/master/tools/install.sh)"
  args:
    creates: "~/.oh-my-zsh"
  tags:
    - zsh
    - cli

- name: Remove existing .zshrc
  file:
    path: ~/.zshrc
    state: absent
  tags:
    - zsh
    - cli

- name: Dotfiles Setup (zsh)
  shell: cd ~/dotfiles && DOTFILES=~/dotfiles ./scripts/setup --single zsh
  tags:
    - dotfiles
    - cli

- name: zsh-autosuggestions install (git)
  ansible.builtin.git:
    repo: 'https://github.com/zsh-users/zsh-autosuggestions'
    dest: "~/.oh-my-zsh/custom/plugins/zsh-autosuggestions"
  tags:
    - zsh
    - cli

- name: zsh-completions install (git)
  ansible.builtin.git:
    repo: 'https://github.com/zsh-users/zsh-completions'
    dest: "~/.oh-my-zsh/custom/plugins/zsh-completions"
  tags:
    - zsh
    - cli

- name: zsh-syntax-highlighting install (git)
  ansible.builtin.git:
    repo: 'https://github.com/zsh-users/zsh-syntax-highlighting'
    dest: "~/.oh-my-zsh/custom/plugins/zsh-syntax-highlighting"
  tags:
    - zsh
    - cli

- name: zsh-history-substring-search install (git)
  ansible.builtin.git:
    repo: 'https://github.com/zsh-users/zsh-history-substring-search'
    dest: "~/.oh-my-zsh/custom/plugins/zsh-history-substring-search"
  tags:
    - zsh
    - cli

- name: spaceship-prompt install (git)
  ansible.builtin.git:
    repo: 'https://github.com/spaceship-prompt/spaceship-prompt'
    dest: "~/.oh-my-zsh/custom/themes/spaceship-prompt"
    depth: 1
  tags:
    - zsh
    - cli

- name: Create spaceship-prompt symbolic link
  file:
    src: "~/.oh-my-zsh/custom/themes/spaceship-prompt/spaceship.zsh-theme"
    dest: "~/.oh-my-zsh/custom/themes/spaceship.zsh-theme"
    state: link
  tags:
    - zsh
    - cli

- name: nvm install (shell)
  shell: curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.3/install.sh | bash
  args:
    creates: ~/.nvm
  tags:
    - cli
    - node

- name: node install (nvm)
  shell: source ~/.nvm/nvm.sh && nvm install lts/fermium lts/gallium
  args:
    executable: /bin/bash
  tags:
    - cli
    - node
    - node-full
    - nvim-lsp

- name: Dotfiles Setup (Common)
  shell: cd ~/dotfiles && DOTFILES=~/dotfiles ./scripts/setup common
  tags:
    - dotfiles
    - cli

- name: create kitty desktop file (Linux)
  shell: cd ~/dotfiles/kitty/.config/kitty && ./kitty-desktop
  tags:
    - kitty
  when: ( ansible_os_family == "Debian" or ansible_os_family == "ArchLinux" )
